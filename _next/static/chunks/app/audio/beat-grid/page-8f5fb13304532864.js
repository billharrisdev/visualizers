(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{861:(e,t,n)=>{"use strict";function r(e){let t="/visualizers";return!t||e.startsWith(t+"/")?e:e.startsWith("/")?"".concat(t).concat(e):"".concat(t,"/").concat(e)}n.d(t,{O:()=>r})},3160:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var r=n(2115),l=n(861);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{fftSize:t=2048,smoothingTimeConstant:n=.8}=e,a=(0,r.useRef)(null),c=(0,r.useRef)(null),s=(0,r.useRef)(null),u=(0,r.useRef)(null),i=(0,r.useRef)(null),[o,d]=(0,r.useState)(!1),[f,m]=(0,r.useState)(.7);(0,r.useEffect)(()=>{let e=new Audio;return e.crossOrigin="anonymous",a.current=e,()=>{e.pause(),e.src="",a.current=null}},[]);let h=(0,r.useCallback)(async()=>{let e=c.current;if(e||(c.current=e=new(window.AudioContext||window.webkitAudioContext)),s.current||(s.current=e.createMediaElementSource(a.current)),!u.current){let r=e.createAnalyser();r.fftSize=t,r.smoothingTimeConstant=n,u.current=r}if(!i.current){let t=e.createGain();t.gain.value=f,i.current=t}s.current.disconnect(),i.current.disconnect(),u.current.disconnect(),s.current.connect(i.current),i.current.connect(e.destination),s.current.connect(u.current)},[t,n,f]);(0,r.useEffect)(()=>{i.current&&(i.current.gain.value=f)},[f]);let x=(0,r.useCallback)(async e=>{await h();let t=a.current;t.src=(0,l.O)(e),await t.play(),d(!0)},[h]),g=(0,r.useCallback)(()=>{var e;null==(e=a.current)||e.pause(),d(!1)},[]),b=(0,r.useCallback)(()=>{a.current&&(a.current.pause(),a.current.currentTime=0),d(!1)},[]);return(0,r.useEffect)(()=>()=>{try{var e,t,n,r;null==(e=u.current)||e.disconnect(),null==(t=i.current)||t.disconnect(),null==(n=s.current)||n.disconnect(),null==(r=c.current)||r.close()}catch(e){}},[]),{audio:a.current,ctx:c.current,analyser:u.current,isPlaying:o,volume:f,setVolume:m,play:x,pause:g,stop:b}}},5300:(e,t,n)=>{Promise.resolve().then(n.bind(n,6425))},6369:(e,t,n)=>{"use strict";n.d(t,{p:()=>r});let r=[{label:"Rock – Take the Lead (Kevin MacLeod)",file:"/audio/kevin-macleod_take-the-lead.mp3",genre:"Rock"},{label:"Jazz – George Street Shuffle (Kevin MacLeod)",file:"/audio/kevin-macleod_george-street-shuffle.mp3",genre:"Jazz"},{label:"Metal – Metalmania (Kevin MacLeod)",file:"/audio/kevin-macleod_metalmania.mp3",genre:"Metal"},{label:"Industrial – Industrial Music Box (Kevin MacLeod)",file:"/audio/kevin-macleod_industrial-music-box.mp3",genre:"Industrial"}]},6425:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n(5155),l=n(2115),a=n(3160),c=n(6369);function s(){let e=(0,l.useRef)(null),{analyser:t,ctx:n,play:s,pause:u,stop:i,isPlaying:o,setVolume:d}=(0,a.e)({fftSize:2048,smoothingTimeConstant:.8}),[f,m]=(0,l.useState)(0),[h,x]=(0,l.useState)(.7),[g,b]=(0,l.useState)(1.5),p=(0,l.useRef)([]),v=(0,l.useRef)(null),y=(0,l.useRef)([]),[N,k]=(0,l.useState)(null),j=(0,l.useRef)(0);return(0,l.useEffect)(()=>d(h),[h,d]),(0,l.useEffect)(()=>{if(!t||!n)return;let r=e.current,l=r.getContext("2d");if(!l)return;let a=r.width,c=r.height,s=t.frequencyBinCount,u=new Float32Array(s),i=()=>{var e;if(!t||!n)return;requestAnimationFrame(i);let r=new Uint8Array(s);t.getByteFrequencyData(r);for(let e=0;e<s;e++)u[e]=r[e]/255;let o=0,d=null!=(e=v.current)?e:u;for(let e=0;e<s;e++){let t=u[e]-d[e];t>0&&(o+=t)}v.current=u.slice(0);let f=p.current;f.push(o),f.length>120&&f.shift();let m=f.reduce((e,t)=>e+t,0)/Math.max(1,f.length)*g;if(f.length>2&&f[f.length-2]>f[f.length-3]&&f[f.length-2]>o&&f[f.length-2]>m){let e=performance.now()/1e3;y.current.push(e);let t=e-12;y.current=y.current.filter(e=>e>=t),j.current=6;let n=y.current,r=[];for(let e=1;e<n.length;e++){let t=n[e]-n[e-1];t>.2&&t<2&&r.push(t)}if(r.length>=2){let e=new Map;for(let t of r){let n=.02*Math.round(t/.02);e.set(n,(e.get(n)||0)+1)}let t=0,n=-1;for(let[r,l]of e)l>n&&(n=l,t=r);t>0&&k(Math.round(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;for(;e<t;)e*=2;for(;e>n;)e/=2;return e}(60/t)))}}l.clearRect(0,0,a,c);let h=j.current>0;j.current>0&&j.current--,l.fillStyle=h?"rgba(239,68,68,0.25)":"rgba(0,0,0,0.08)",l.fillRect(0,0,a,c),l.strokeStyle="rgba(100,116,139,0.35)",l.lineWidth=1;for(let e=0;e<=16;e++){let t=Math.round(e/16*a)+.5;l.beginPath(),l.moveTo(t,0),l.lineTo(t,c),l.stroke()}for(let e=0;e<=8;e++){let t=Math.round(e/8*c)+.5;l.beginPath(),l.moveTo(0,t),l.lineTo(a,t),l.stroke()}let x=Math.max(0,Math.min(2,o/(m||1e-6))),b=Math.min(a-40,300);l.fillStyle="#e5e7eb",l.fillRect(20,c-32,b,12),l.fillStyle="#22c55e",l.fillRect(20,c-32,b*Math.min(x/2,1),12),l.fillStyle="#9ca3af",l.font="12px sans-serif",l.fillText("Flux ".concat(o.toFixed(3),"  Thresh ").concat(m.toFixed(3)),20,c-40),N&&(l.fillStyle="#3b82f6",l.font="bold 24px sans-serif",l.fillText("".concat(N," BPM"),a-140,36))};requestAnimationFrame(i)},[t,n,g,N]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Track"}),(0,r.jsx)("select",{className:"border rounded-md px-3 py-2 bg-background",value:f,onChange:e=>m(Number(e.target.value)),disabled:o,children:c.p.map((e,t)=>(0,r.jsx)("option",{value:t,children:e.label},e.file))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>s(c.p[f].file),disabled:o,children:"Play"}),(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:u,disabled:!o,children:"Pause"}),(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:i,children:"Stop"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Volume"}),(0,r.jsx)("input",{type:"range",min:0,max:1,step:.01,value:h,onChange:e=>x(Number(e.target.value)),className:"w-40"}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[Math.round(100*h),"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Sensitivity"}),(0,r.jsx)("input",{type:"range",min:1,max:2.5,step:.05,value:g,onChange:e=>b(Number(e.target.value)),className:"w-40"}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[g.toFixed(2),"\xd7"]})]})]}),(0,r.jsx)("div",{className:"border rounded-lg p-3 bg-muted/20",children:(0,r.jsx)("canvas",{ref:e,width:900,height:260,className:"w-full h-[260px]"})})]})}function u(){return(0,r.jsxs)("section",{className:"py-8 container max-w-5xl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Beat Grid & BPM"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:"Live onset detection with spectral flux, adaptive threshold, and BPM estimate."}),(0,r.jsx)(s,{})]})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=5300)),_N_E=e.O()}]);