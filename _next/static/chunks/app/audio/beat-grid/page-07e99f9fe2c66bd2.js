(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{861:(e,t,n)=>{"use strict";function l(e){let t="/visualizers";return!t||e.startsWith(t+"/")?e:e.startsWith("/")?"".concat(t).concat(e):"".concat(t,"/").concat(e)}n.d(t,{O:()=>l})},3160:(e,t,n)=>{"use strict";n.d(t,{e:()=>a});var l=n(2115),r=n(861);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{fftSize:t=2048,smoothingTimeConstant:n=.8}=e,a=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null),u=(0,l.useRef)(null),i=(0,l.useRef)(null),[o,d]=(0,l.useState)(!1),[f,m]=(0,l.useState)(.7);(0,l.useEffect)(()=>{let e=new Audio;return e.crossOrigin="anonymous",a.current=e,()=>{e.pause(),e.src="",a.current=null}},[]);let h=(0,l.useCallback)(async()=>{let e=s.current;if(e||(s.current=e=new(window.AudioContext||window.webkitAudioContext)),c.current||(c.current=e.createMediaElementSource(a.current)),!u.current){let l=e.createAnalyser();l.fftSize=t,l.smoothingTimeConstant=n,u.current=l}if(!i.current){let t=e.createGain();t.gain.value=f,i.current=t}c.current.disconnect(),i.current.disconnect(),u.current.disconnect(),c.current.connect(i.current),i.current.connect(e.destination),c.current.connect(u.current)},[t,n,f]);(0,l.useEffect)(()=>{i.current&&(i.current.gain.value=f)},[f]);let x=(0,l.useCallback)(async e=>{await h();let t=a.current;t.src=(0,r.O)(e),await t.play(),d(!0)},[h]),g=(0,l.useCallback)(()=>{var e;null==(e=a.current)||e.pause(),d(!1)},[]),p=(0,l.useCallback)(()=>{a.current&&(a.current.pause(),a.current.currentTime=0),d(!1)},[]);return(0,l.useEffect)(()=>()=>{try{var e,t,n,l;null==(e=u.current)||e.disconnect(),null==(t=i.current)||t.disconnect(),null==(n=c.current)||n.disconnect(),null==(l=s.current)||l.close()}catch(e){}},[]),{audio:a.current,ctx:s.current,analyser:u.current,isPlaying:o,volume:f,setVolume:m,play:x,pause:g,stop:p}}},5300:(e,t,n)=>{Promise.resolve().then(n.bind(n,6425))},6369:(e,t,n)=>{"use strict";n.d(t,{p:()=>l});let l=[{label:"Rock – Take the Lead (Kevin MacLeod)",file:"/audio/kevin-macleod_take-the-lead.mp3",genre:"Rock"},{label:"Jazz – George Street Shuffle (Kevin MacLeod)",file:"/audio/kevin-macleod_george-street-shuffle.mp3",genre:"Jazz"},{label:"Metal – Metalmania (Kevin MacLeod)",file:"/audio/kevin-macleod_metalmania.mp3",genre:"Metal"},{label:"Industrial – Industrial Music Box (Kevin MacLeod)",file:"/audio/kevin-macleod_industrial-music-box.mp3",genre:"Industrial"}]},6425:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var l=n(5155),r=n(2115),a=n(3160),s=n(6369);function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;for(;e<t;)e*=2;for(;e>n;)e/=2;return e}function u(){let e=(0,r.useRef)(null),{analyser:t,ctx:n,play:u,pause:i,stop:o,isPlaying:d,setVolume:f}=(0,a.e)({fftSize:2048,smoothingTimeConstant:.8}),[m,h]=(0,r.useState)(0),[x,g]=(0,r.useState)(.7),[p,b]=(0,r.useState)(1.5),[v,y]=(0,r.useState)(8),N=(0,r.useRef)([]),j=(0,r.useRef)(null),k=(0,r.useRef)([]),[S,M]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[T,R]=(0,r.useState)(null),P=(0,r.useRef)(0),A=(0,r.useRef)([]),[F,_]=(0,r.useState)(null);return(0,r.useEffect)(()=>f(x),[x,f]),(0,r.useEffect)(()=>{if(!t||!n)return;let l=e.current,r=l.getContext("2d");if(!r)return;let a=l.width,s=l.height,u=t.frequencyBinCount,i=new Float32Array(u),o=()=>{var e;if(!t||!n)return;requestAnimationFrame(o);let l=new Uint8Array(u);t.getByteFrequencyData(l);for(let e=0;e<u;e++)i[e]=l[e]/255;let d=0,f=null!=(e=j.current)?e:i;for(let e=0;e<u;e++){let t=i[e]-f[e];t>0&&(d+=t)}j.current=i.slice(0);let m=N.current;m.push(d),m.length>120&&m.shift();let h=m.reduce((e,t)=>e+t,0)/Math.max(1,m.length)*p;if(m.length>2&&m[m.length-2]>m[m.length-3]&&m[m.length-2]>d&&m[m.length-2]>h){let e=performance.now()/1e3;k.current.push(e);let t=e-12;k.current=k.current.filter(e=>e>=t),P.current=6;let n=k.current,l=[];for(let e=1;e<n.length;e++){let t=n[e]-n[e-1];t>.2&&t<2&&l.push(t)}if(l.length>=2){let e=new Map;for(let t of l){let n=.02*Math.round(t/.02);e.set(n,(e.get(n)||0)+1)}let t=0,n=-1;for(let[l,r]of e)r>n&&(n=r,t=l);if(t>0){M(Math.round(c(60/t))),C(Math.max(0,Math.min(1,n/(Array.from(e.values()).reduce((e,t)=>e+t,0)||1))));let r=l.map(e=>c(60/e)),a=r.reduce((e,t)=>e+t,0)/r.length;R(Math.sqrt(r.reduce((e,t)=>e+(t-a)*(t-a),0)/r.length))}}}r.clearRect(0,0,a,s);let x=P.current>0;P.current>0&&P.current--,r.fillStyle=x?"rgba(239,68,68,0.25)":"rgba(0,0,0,0.08)",r.fillRect(0,0,a,s),r.strokeStyle="rgba(100,116,139,0.35)",r.lineWidth=1;for(let e=0;e<=16;e++){let t=Math.round(e/16*a)+.5;r.beginPath(),r.moveTo(t,0),r.lineTo(t,s),r.stroke()}for(let e=0;e<=8;e++){let t=Math.round(e/8*s)+.5;r.beginPath(),r.moveTo(0,t),r.lineTo(a,t),r.stroke()}let g=Math.max(0,Math.min(2,d/(h||1e-6))),b=Math.min(a-40,300);if(r.fillStyle="#e5e7eb",r.fillRect(20,s-32,b,12),r.fillStyle="#22c55e",r.fillRect(20,s-32,b*Math.min(g/2,1),12),r.fillStyle="#9ca3af",r.font="12px sans-serif",r.fillText("Flux ".concat(d.toFixed(3),"  Thresh ").concat(h.toFixed(3)),20,s-40),r.fillStyle="#3b82f6",r.font="bold 24px sans-serif",r.textAlign="right",r.fillText("".concat(null!=S?S:"--"," BPM"),a-16,36),r.textAlign="left",null!=w){let e=a-180;r.fillStyle="#1f2937",r.fillRect(e,50,160,8),r.fillStyle="#3b82f6",r.fillRect(e,50,160*w,8),r.fillStyle="#93c5fd",r.font="12px sans-serif",r.fillText("Confidence ".concat((100*w).toFixed(0),"%"),e,48)}null!=T&&(r.fillStyle="#93c5fd",r.font="12px sans-serif",r.fillText("StdDev ".concat(T.toFixed(1)," BPM"),a-180,84));let y=performance.now()/1e3,A=s-1;for(let e of(r.strokeStyle="#64748b",r.beginPath(),r.moveTo(20,A-18),r.lineTo(a-20,A-18),r.stroke(),k.current)){let t=y-e;if(t<0||t>v)continue;let n=20+(1-t/v)*(a-40);r.strokeStyle="#f87171",r.beginPath(),r.moveTo(n+.5,A-26),r.lineTo(n+.5,A-10),r.stroke()}};requestAnimationFrame(o)},[t,n,p,S]),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Track"}),(0,l.jsx)("select",{className:"border rounded-md px-3 py-2 bg-background",value:m,onChange:e=>h(Number(e.target.value)),disabled:d,children:s.p.map((e,t)=>(0,l.jsx)("option",{value:t,children:e.label},e.file))})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>u(s.p[m].file),disabled:d,children:"Play"}),(0,l.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:i,disabled:!d,children:"Pause"}),(0,l.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:o,children:"Stop"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>{let e=performance.now()/1e3,t=A.current;if(0===t.length||e-t[t.length-1]>2.5){A.current=[e],_(null);return}t.push(e),t.length>8&&t.shift();let n=t.slice(1).map((e,n)=>e-t[n]).filter(e=>e>.2&&e<2);if(n.length){let e=n.map(e=>c(60/e));_(Math.round(e.reduce((e,t)=>e+t,0)/e.length))}},children:"Tap"}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground tabular-nums",children:["Tap: ",null!=F?F:"--"," BPM"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{className:"text-sm text-muted-foreground",children:"Volume"}),(0,l.jsx)("input",{type:"range",min:0,max:1,step:.01,value:x,onChange:e=>g(Number(e.target.value)),className:"w-40"}),(0,l.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[Math.round(100*x),"%"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{className:"text-sm text-muted-foreground",children:"Sensitivity"}),(0,l.jsx)("input",{type:"range",min:1,max:2.5,step:.05,value:p,onChange:e=>b(Number(e.target.value)),className:"w-40"}),(0,l.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[p.toFixed(2),"\xd7"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{className:"text-sm text-muted-foreground",children:"Timeline"}),(0,l.jsx)("input",{type:"range",min:4,max:12,step:1,value:v,onChange:e=>y(Number(e.target.value)),className:"w-40"}),(0,l.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[v,"s"]})]})]}),(0,l.jsx)("div",{className:"border rounded-lg p-3 bg-muted/20",children:(0,l.jsx)("canvas",{ref:e,width:900,height:260,className:"w-full h-[260px]"})})]})}function i(){return(0,l.jsxs)("section",{className:"py-8 container max-w-5xl",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Beat Grid & BPM"}),(0,l.jsx)("p",{className:"text-muted-foreground mb-6",children:"Live onset detection with spectral flux, adaptive threshold, and BPM estimate."}),(0,l.jsx)(u,{})]})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=5300)),_N_E=e.O()}]);