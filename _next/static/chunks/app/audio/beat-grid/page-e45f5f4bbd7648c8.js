(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[175],{861:(e,t,l)=>{"use strict";function n(e){let t="/visualizers";return!t||e.startsWith(t+"/")?e:e.startsWith("/")?"".concat(t).concat(e):"".concat(t,"/").concat(e)}l.d(t,{O:()=>n})},3160:(e,t,l)=>{"use strict";l.d(t,{e:()=>a});var n=l(2115),r=l(861);function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{fftSize:t=2048,smoothingTimeConstant:l=.8}=e,a=(0,n.useRef)(null),s=(0,n.useRef)(null),c=(0,n.useRef)(null),u=(0,n.useRef)(null),i=(0,n.useRef)(null),[o,d]=(0,n.useState)(!1),[f,m]=(0,n.useState)(.7);(0,n.useEffect)(()=>{let e=new Audio;return e.crossOrigin="anonymous",a.current=e,()=>{e.pause(),e.src="",a.current=null}},[]);let h=(0,n.useCallback)(async()=>{let e=s.current;if(e||(s.current=e=new(window.AudioContext||window.webkitAudioContext)),c.current||(c.current=e.createMediaElementSource(a.current)),!u.current){let n=e.createAnalyser();n.fftSize=t,n.smoothingTimeConstant=l,u.current=n}if(!i.current){let t=e.createGain();t.gain.value=f,i.current=t}c.current.disconnect(),i.current.disconnect(),u.current.disconnect(),c.current.connect(i.current),i.current.connect(e.destination),c.current.connect(u.current)},[t,l,f]);(0,n.useEffect)(()=>{i.current&&(i.current.gain.value=f)},[f]);let x=(0,n.useCallback)(async e=>{await h();let t=a.current;t.src=(0,r.O)(e),await t.play(),d(!0)},[h]),g=(0,n.useCallback)(()=>{var e;null==(e=a.current)||e.pause(),d(!1)},[]),p=(0,n.useCallback)(()=>{a.current&&(a.current.pause(),a.current.currentTime=0),d(!1)},[]);return(0,n.useEffect)(()=>()=>{try{var e,t,l,n;null==(e=u.current)||e.disconnect(),null==(t=i.current)||t.disconnect(),null==(l=c.current)||l.disconnect(),null==(n=s.current)||n.close()}catch(e){}},[]),{audio:a.current,ctx:s.current,analyser:u.current,isPlaying:o,volume:f,setVolume:m,play:x,pause:g,stop:p}}},5300:(e,t,l)=>{Promise.resolve().then(l.bind(l,6425))},6369:(e,t,l)=>{"use strict";l.d(t,{p:()=>n});let n=[{label:"Rock – Take the Lead (Kevin MacLeod)",file:"/audio/kevin-macleod_take-the-lead.mp3",genre:"Rock"},{label:"Jazz – George Street Shuffle (Kevin MacLeod)",file:"/audio/kevin-macleod_george-street-shuffle.mp3",genre:"Jazz"},{label:"Metal – Metalmania (Kevin MacLeod)",file:"/audio/kevin-macleod_metalmania.mp3",genre:"Metal"},{label:"Industrial – Industrial Music Box (Kevin MacLeod)",file:"/audio/kevin-macleod_industrial-music-box.mp3",genre:"Industrial"}]},6425:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>i});var n=l(5155),r=l(2115),a=l(3160),s=l(6369);function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:180;for(;e<t;)e*=2;for(;e>l;)e/=2;return e}function u(){let e=(0,r.useRef)(null),{analyser:t,ctx:l,play:u,pause:i,stop:o,isPlaying:d,setVolume:f}=(0,a.e)({fftSize:2048,smoothingTimeConstant:.8}),[m,h]=(0,r.useState)(0),[x,g]=(0,r.useState)(.7),[p,b]=(0,r.useState)(1.5),[v,y]=(0,r.useState)(8),k=(0,r.useRef)([]),N=(0,r.useRef)(null),j=(0,r.useRef)([]),[S,M]=(0,r.useState)(null),[w,T]=(0,r.useState)(null),[C,R]=(0,r.useState)(null),P=(0,r.useRef)(0),A=(0,r.useRef)([]),[F,_]=(0,r.useState)(null),[B,E]=(0,r.useState)(!1),z=(0,r.useRef)(null);return(0,r.useEffect)(()=>f(x),[x,f]),(0,r.useEffect)(()=>{if(!t||!l)return;let n=e.current,r=n.getContext("2d");if(!r)return;let a=n.width,s=n.height,u=t.frequencyBinCount,i=new Float32Array(u),o=()=>{var e,n,d;if(!t||!l)return;requestAnimationFrame(o);let f=new Uint8Array(u);t.getByteFrequencyData(f);for(let e=0;e<u;e++)i[e]=f[e]/255;let m=0,h=null!=(e=N.current)?e:i;for(let e=0;e<u;e++){let t=i[e]-h[e];t>0&&(m+=t)}N.current=i.slice(0);let x=k.current;x.push(m),x.length>120&&x.shift();let g=x.reduce((e,t)=>e+t,0)/Math.max(1,x.length)*p;if(x.length>2&&x[x.length-2]>x[x.length-3]&&x[x.length-2]>m&&x[x.length-2]>g){let e=performance.now()/1e3;j.current.push(e);let t=e-12;j.current=j.current.filter(e=>e>=t),P.current=6;let l=j.current,n=[];for(let e=1;e<l.length;e++){let t=l[e]-l[e-1];t>.2&&t<2&&n.push(t)}if(n.length>=2){let e=new Map;for(let t of n){let l=.02*Math.round(t/.02);e.set(l,(e.get(l)||0)+1)}let t=0,l=-1;for(let[n,r]of e)r>l&&(l=r,t=n);if(t>0){M(Math.round(c(60/t))),T(Math.max(0,Math.min(1,l/(Array.from(e.values()).reduce((e,t)=>e+t,0)||1))));let r=n.map(e=>c(60/e)),a=r.reduce((e,t)=>e+t,0)/r.length;R(Math.sqrt(r.reduce((e,t)=>e+(t-a)*(t-a),0)/r.length))}}}r.clearRect(0,0,a,s);let b=P.current>0;P.current>0&&P.current--,r.fillStyle=b?"rgba(239,68,68,0.25)":"rgba(0,0,0,0.08)",r.fillRect(0,0,a,s);let y=a/8,A=B&&F?F:null!=S?S:120,_=performance.now()/1e3,E=B?null!=(n=z.current)?n:_:null!=(d=j.current[j.current.length-1])?d:_,L=(_-E)/(60/A)%1;r.strokeStyle="rgba(100,116,139,0.35)",r.lineWidth=1;for(let e=-1;e<=9;e++){let t=Math.round((e-L)*y)+.5;t<0||t>a||(r.beginPath(),r.moveTo(t,0),r.lineTo(t,s),r.stroke())}r.strokeStyle="rgba(100,116,139,0.2)";for(let e=-1;e<=9;e++)for(let t=1;t<4;t++){let l=Math.round((e-L+t/4)*y)+.5;l<0||l>a||(r.beginPath(),r.moveTo(l,0),r.lineTo(l,s),r.stroke())}let q=Math.max(0,Math.min(2,m/(g||1e-6))),O=Math.min(a-40,300);r.fillStyle="#e5e7eb",r.fillRect(20,s-32,O,12),r.fillStyle="#22c55e",r.fillRect(20,s-32,O*Math.min(q/2,1),12),r.strokeStyle="#ef4444",r.lineWidth=2;let G=20+.5*O;if(r.beginPath(),r.moveTo(G+.5,s-36),r.lineTo(G+.5,s-18),r.stroke(),r.fillStyle="#9ca3af",r.font="12px sans-serif",r.fillText("Flux ".concat(m.toFixed(3),"  Thresh ").concat(g.toFixed(3)),20,s-40),r.fillStyle="#3b82f6",r.font="bold 24px sans-serif",r.textAlign="right",r.fillText("".concat(null!=S?S:"--"," BPM"),a-16,36),r.textAlign="left",null!=w){let e=a-180;r.fillStyle="#1f2937",r.fillRect(e,50,160,8),r.fillStyle="#3b82f6",r.fillRect(e,50,160*w,8),r.fillStyle="#93c5fd",r.font="12px sans-serif",r.fillText("Confidence ".concat((100*w).toFixed(0),"%"),e,48)}null!=C&&(r.fillStyle="#93c5fd",r.font="12px sans-serif",r.fillText("StdDev ".concat(C.toFixed(1)," BPM"),a-180,84));let I=performance.now()/1e3,K=s-1;for(let e of(r.strokeStyle="#64748b",r.beginPath(),r.moveTo(20,K-18),r.lineTo(a-20,K-18),r.stroke(),j.current)){let t=I-e;if(t<0||t>v)continue;let l=20+(1-t/v)*(a-40);r.strokeStyle="#f87171",r.beginPath(),r.moveTo(l+.5,K-26),r.lineTo(l+.5,K-10),r.stroke()}for(let e of j.current){let t=I-e;if(t<0||t>v)continue;let l=Math.max(0,1-t/v),n=20+(1-t/v)*(a-40);r.fillStyle="rgba(248,113,113,".concat(l.toFixed(3),")");let s=4+4*(1-t/v);r.beginPath(),r.arc(n,16,s,0,2*Math.PI),r.fill()}};requestAnimationFrame(o)},[t,l,p,S,B,F,v,w,C]),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Track"}),(0,n.jsx)("select",{className:"border rounded-md px-3 py-2 bg-background",value:m,onChange:e=>h(Number(e.target.value)),disabled:d,children:s.p.map((e,t)=>(0,n.jsx)("option",{value:t,children:e.label},e.file))})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>u(s.p[m].file),disabled:d,children:"Play"}),(0,n.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:i,disabled:!d,children:"Pause"}),(0,n.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:o,children:"Stop"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>{let e=performance.now()/1e3,t=A.current;if(0===t.length||e-t[t.length-1]>2.5){A.current=[e],_(null),B&&(z.current=e);return}t.push(e),t.length>8&&t.shift();let l=t.slice(1).map((e,l)=>e-t[l]).filter(e=>e>.2&&e<2);if(l.length){let t=l.map(e=>c(60/e));_(Math.round(t.reduce((e,t)=>e+t,0)/t.length)),B&&(z.current=e)}},children:"Tap"}),(0,n.jsxs)("div",{className:"text-xs text-muted-foreground tabular-nums",children:["Tap: ",null!=F?F:"--"," BPM"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm text-muted-foreground",children:"Grid Lock to Tap"}),(0,n.jsx)("input",{type:"checkbox",checked:B,onChange:e=>{E(e.target.checked),e.target.checked&&(z.current=performance.now()/1e3)}})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm text-muted-foreground",children:"Volume"}),(0,n.jsx)("input",{type:"range",min:0,max:1,step:.01,value:x,onChange:e=>g(Number(e.target.value)),className:"w-40"}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[Math.round(100*x),"%"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm text-muted-foreground",children:"Sensitivity"}),(0,n.jsx)("input",{type:"range",min:1,max:2.5,step:.05,value:p,onChange:e=>b(Number(e.target.value)),className:"w-40"}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[p.toFixed(2),"\xd7"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm text-muted-foreground",children:"Timeline"}),(0,n.jsx)("input",{type:"range",min:4,max:12,step:1,value:v,onChange:e=>y(Number(e.target.value)),className:"w-40"}),(0,n.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[v,"s"]})]})]}),(0,n.jsx)("div",{className:"border rounded-lg p-3 bg-muted/20",children:(0,n.jsx)("canvas",{ref:e,width:900,height:260,className:"w-full h-[260px]"})})]})}function i(){return(0,n.jsxs)("section",{className:"py-8 container max-w-5xl",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Beat Grid & BPM"}),(0,n.jsx)("p",{className:"text-muted-foreground mb-6",children:"Live onset detection with spectral flux, adaptive threshold, and BPM estimate."}),(0,n.jsx)(u,{})]})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=5300)),_N_E=e.O()}]);