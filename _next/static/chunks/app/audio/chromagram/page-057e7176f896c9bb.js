(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{861:(e,t,n)=>{"use strict";function r(e){let t="/visualizers";return!t||e.startsWith(t+"/")?e:e.startsWith("/")?"".concat(t).concat(e):"".concat(t,"/").concat(e)}n.d(t,{O:()=>r})},3160:(e,t,n)=>{"use strict";n.d(t,{e:()=>l});var r=n(2115),a=n(861);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{fftSize:t=2048,smoothingTimeConstant:n=.8}=e,l=(0,r.useRef)(null),c=(0,r.useRef)(null),s=(0,r.useRef)(null),u=(0,r.useRef)(null),i=(0,r.useRef)(null),[o,d]=(0,r.useState)(!1),[m,f]=(0,r.useState)(.7);(0,r.useEffect)(()=>{let e=new Audio;return e.crossOrigin="anonymous",l.current=e,()=>{e.pause(),e.src="",l.current=null}},[]);let h=(0,r.useCallback)(async()=>{let e=c.current;if(e||(c.current=e=new(window.AudioContext||window.webkitAudioContext)),s.current||(s.current=e.createMediaElementSource(l.current)),!u.current){let r=e.createAnalyser();r.fftSize=t,r.smoothingTimeConstant=n,u.current=r}if(!i.current){let t=e.createGain();t.gain.value=m,i.current=t}s.current.disconnect(),i.current.disconnect(),u.current.disconnect(),s.current.connect(i.current),i.current.connect(e.destination),s.current.connect(u.current)},[t,n,m]);(0,r.useEffect)(()=>{i.current&&(i.current.gain.value=m)},[m]);let x=(0,r.useCallback)(async e=>{await h();let t=l.current;t.src=(0,a.O)(e),await t.play(),d(!0)},[h]),g=(0,r.useCallback)(()=>{var e;null==(e=l.current)||e.pause(),d(!1)},[]),p=(0,r.useCallback)(()=>{l.current&&(l.current.pause(),l.current.currentTime=0),d(!1)},[]);return(0,r.useEffect)(()=>()=>{try{var e,t,n,r;null==(e=u.current)||e.disconnect(),null==(t=i.current)||t.disconnect(),null==(n=s.current)||n.disconnect(),null==(r=c.current)||r.close()}catch(e){}},[]),{audio:l.current,ctx:c.current,analyser:u.current,isPlaying:o,volume:m,setVolume:f,play:x,pause:g,stop:p}}},5128:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n(5155),a=n(2115),l=n(3160),c=n(6369);let s=[6.35,2.23,3.48,2.33,4.38,4.09,2.52,5.19,2.39,3.66,2.29,2.88],u=[6.33,2.68,3.52,5.38,2.6,3.53,2.54,4.75,3.98,2.69,3.34,3.17],i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function o(e,t){let n=e.length,r=Array(n);for(let a=0;a<n;a++)r[(a+t)%n]=e[a];return r}function d(e){let t=e.reduce((e,t)=>e+t,0)||1;return e.map(e=>e/t)}function m(){let e=(0,a.useRef)(null),{analyser:t,play:n,pause:m,stop:f,isPlaying:h,setVolume:x,ctx:g}=(0,l.e)({fftSize:4096,smoothingTimeConstant:.8}),[p,b]=(0,a.useState)(0),[v,y]=(0,a.useState)(.7),[N,j]=(0,a.useState)(.7);(0,a.useEffect)(()=>x(v),[v,x]);let M=(0,a.useMemo)(()=>{var e;if(!t)return null;let n=null!=(e=null==g?void 0:g.sampleRate)?e:44100,r=t.frequencyBinCount,a=Array(r).fill(-1);for(let e=1;e<r;e++){let r=e*n/t.fftSize;if(r<27.5||r>5e3)continue;let l=(Math.round(69+12*Math.log2(r/440))%12+12)%12;a[e]=l}return a},[t,g]),k=(0,a.useRef)(Array(12).fill(0)),C=(0,a.useRef)(null),w=e=>30*e%360;return(0,a.useEffect)(()=>{if(!t||!M)return;let n=e.current,r=n.getContext("2d");if(!r)return;let a=t.frequencyBinCount,l=new Uint8Array(a),c=()=>{if(!t)return;requestAnimationFrame(c),t.getByteFrequencyData(l);let e=Array(12).fill(0);for(let t=0;t<a;t++){let n=M[t];n<0||(e[n]+=l[t]/255)}let m=d(e);for(let e=0;e<12;e++)k.current[e]=k.current[e]*N+m[e]*(1-N);let f=d(s),h=d(u),x=-1/0,g="C",p="maj";for(let e=0;e<12;e++){let t=o(f,e),n=o(h,e),r=0,a=0;for(let e=0;e<12;e++)r+=k.current[e]*t[e],a+=k.current[e]*n[e];r>x&&(x=r,g=i[e],p="maj"),a>x&&(x=a,g=i[e],p="min")}C.current="".concat(g," ").concat(p);let b=n.width,v=n.height;r.clearRect(0,0,b,v);let y=.42*Math.min(b,v),j=.55*y;r.save(),r.translate(b/2,v/2);for(let e=0;e<12;e++){let t=e/12*Math.PI*2,n=(e+1)/12*Math.PI*2,a=Math.min(1,3*k.current[e]),l=j+(y-j)*a;r.beginPath(),r.moveTo(j*Math.cos(t),j*Math.sin(t)),r.arc(0,0,l,t,n),r.lineTo(j*Math.cos(n),j*Math.sin(n)),r.closePath(),r.fillStyle="hsl(".concat(w(e)," 80% ").concat(Math.round(35+35*a),"%)"),r.fill(),r.save();let c=(t+n)/2,s=y+18;r.translate(s*Math.cos(c),s*Math.sin(c)),r.rotate(c+Math.PI/2),r.fillStyle="#94a3b8",r.font="12px sans-serif",r.textAlign="center",r.fillText(i[e],0,0),r.restore()}r.restore(),r.fillStyle="#e5e7eb",r.font="bold 22px sans-serif",r.textAlign="center",r.fillText(C.current||"",b/2,v/2+8)};requestAnimationFrame(c)},[t,M,N]),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-muted-foreground mb-1",children:"Track"}),(0,r.jsx)("select",{className:"border rounded-md px-3 py-2 bg-background",value:p,onChange:e=>b(Number(e.target.value)),disabled:h,children:c.p.map((e,t)=>(0,r.jsx)("option",{value:t,children:e.label},e.file))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:()=>n(c.p[p].file),disabled:h,children:"Play"}),(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:m,disabled:!h,children:"Pause"}),(0,r.jsx)("button",{className:"border rounded-md px-3 py-2 hover:bg-accent",onClick:f,children:"Stop"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Volume"}),(0,r.jsx)("input",{type:"range",min:0,max:1,step:.01,value:v,onChange:e=>y(Number(e.target.value)),className:"w-40"}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground tabular-nums",children:[Math.round(100*v),"%"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-muted-foreground",children:"Smoothing"}),(0,r.jsx)("input",{type:"range",min:.3,max:.95,step:.01,value:N,onChange:e=>j(Number(e.target.value)),className:"w-40"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground tabular-nums",children:N.toFixed(2)})]})]}),(0,r.jsx)("div",{className:"border rounded-lg p-3 bg-muted/20",children:(0,r.jsx)("canvas",{ref:e,width:900,height:420,className:"w-full h-[420px]"})})]})}function f(){return(0,r.jsxs)("section",{className:"py-8 container max-w-5xl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Chromagram / Key Wheel"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-6",children:"12 pitch classes around a ring with key detection (Krumhansl profiles)."}),(0,r.jsx)(m,{})]})}},6369:(e,t,n)=>{"use strict";n.d(t,{p:()=>r});let r=[{label:"Rock – Take the Lead (Kevin MacLeod)",file:"/audio/kevin-macleod_take-the-lead.mp3",genre:"Rock"},{label:"Jazz – George Street Shuffle (Kevin MacLeod)",file:"/audio/kevin-macleod_george-street-shuffle.mp3",genre:"Jazz"},{label:"Metal – Metalmania (Kevin MacLeod)",file:"/audio/kevin-macleod_metalmania.mp3",genre:"Metal"},{label:"Industrial – Industrial Music Box (Kevin MacLeod)",file:"/audio/kevin-macleod_industrial-music-box.mp3",genre:"Industrial"}]},8156:(e,t,n)=>{Promise.resolve().then(n.bind(n,5128))}},e=>{e.O(0,[441,964,358],()=>e(e.s=8156)),_N_E=e.O()}]);